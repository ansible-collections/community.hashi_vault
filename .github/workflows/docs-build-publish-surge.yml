---
name: Ansible collection docs - post comment and publish to Surge
on:
  workflow_call:
    inputs:
      artifact-name:
        description: The build artifact that contains the rendered HTML.
        required: true
        type: string
      surge-site-name:
        description: The full surge site domain to publish to.
        required: true
        type: string
    secrets:
      SURGE_TOKEN:
        description: The token used for publishing to surge.
        required: true
jobs:
  build-ansible-docs:
    name: Publish to Surge.sh
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: DEBUG
        run: |
          echo <<EOF
          ${{ toJSON(inputs) }}
          EOF

      - name: Retrieve rendered docs
        id: download
        uses: actions/download-artifact@v2
        with:
          name: ${{ inputs.artifact-name }}
          path: html

      - name: Install Node
        uses: actions/setup-node@v2
        with:
          node-version: 14

      - name: Install Surge
        run: npm install -g surge

      - name: Publish site
        working-directory: html
        run: surge ./ "${{ inputs.surge-site-name }}" --token ${{ secrets.SURGE_TOKEN }}
