name: Collection Docs (v2)
# concurrency:
#   group: docs-full-${{ github.head_ref }}
#   cancel-in-progress: true
on:
  pull_request_target:
    types: [opened, synchronize, reopened, closed]

jobs:
  build-docs:
    if: github.event.action != 'closed'
    name: Build Ansible Docs
    uses: ansible-collections/community.hashi_vault/.github/workflows/docs-build-pr.yml@docs/build-v2
  publish-docs:
    if: github.event.action != 'closed'
    permissions:
      contents: read
      pull-requests: write
    needs: build-docs
    name: Publish Ansible Docs
    uses: ansible-collections/community.hashi_vault/.github/workflows/docs-build-publish-surge.yml@docs/build-v2
    with:
      artifact-name: ${{ needs.build-docs.outputs.artifact-name }}
      surge-site-name: community-hashi-vault-pr${{github.event.number }}.surge.sh
    secrets:
      SURGE_TOKEN: ${{ secrets.SURGE_TOKEN }}
    # runs-on: ubuntu-latest
    # steps:
    #   - run: |
    #       echo <<EOF
    #       ${{ toJSON(needs.build-docs.outputs) }}
    #       EOF
