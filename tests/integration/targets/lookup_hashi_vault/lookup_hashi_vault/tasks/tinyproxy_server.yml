---
- name: Install tinyproxy
  shell: |
    apt-get update
    DEBIAN_FRONTEND=noninteractive apt-get --assume-yes install tinyproxy
  changed_when: false

- name: Configure good tinyproxy
  copy:
    content: |
      Port 8001
      MaxClients 100
      StartServers 10
    dest: /tinyproxy_ok.conf

- name: Configure wrong tinyproxy
  copy:
    content: |
      Port 8002
      MaxClients 100
      StartServers 10
      Allow 1.1.1.1
    dest: /tinyproxy_ko.conf

- name: Start tinyproxy
  shell: |
    tinyproxy -c /tinyproxy_ok.conf
    tinyproxy -c /tinyproxy_ko.conf
  changed_when: false
