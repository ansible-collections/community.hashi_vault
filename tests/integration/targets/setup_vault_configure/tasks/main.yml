---
- name: Configuration tasks
  # module_defaults:
  #   ansible.legacy.vault_ci_enable_engine: '{{ vault_plugins_module_defaults_common }}'
  #   ansible.legacy.vault_ci_kv_put: '{{ vault_plugins_module_defaults_common }}'
  #   ansible.legacy.vault_ci_policy_put: '{{ vault_plugins_module_defaults_common }}'
  #   ansible.legacy.vault_ci_read: '{{ vault_plugins_module_defaults_common }}'
  #   ansible.legacy.vault_ci_write: '{{ vault_plugins_module_defaults_common }}'
  block:
    - name: 'Canary for Vault basic setup'
      vault_ci_read:
        url: '{{ vault_test_server_http }}'
        token: '{{ vault_dev_root_token_id }}'
        path: '{{ vault_configure_canary.path }}'
      register: canary

    - name: 'Configure Vault basic setup'
      include_tasks: configure.yml
      when: canary.result is none
