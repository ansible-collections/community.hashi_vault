---
- name: state=deleted on a non-existent path
  community.hashi_vault.vault_kv2:
    path: module_kv_v2/write_non_existent
    state: deleted
  ignore_errors: true
  register: deleted_non_existent

- assert:
    that:
      - deleted_non_existent is failed
      - deleted_non_existent is search("Invalid path")
    fail_msg: "{{ deleted_non_existent | string }}"

- name: state=deleted given an invalid version
  community.hashi_vault.vault_kv2:
    path: module_kv_v2/write1
    state: deleted
    versions:
      - 100
  ignore_errors: true
  register: deleted_invalid_version

- assert:
    that:
      - deleted_non_existent is failed
      - deleted_non_existent is search("Invalid path")
    fail_msg: "{{ deleted_invalid_version | string }}"

- name: state=deleted with a token lacking permissions
  community.hashi_vault.vault_kv2:
    path: module_kv_v2/write1
    token: "{{ test_policy_token }}"
    state: deleted
  ignore_errors: true
  register: deleted_forbidden

- assert:
    that:
      - deleted_forbidden is failed
      - deleted_forbidden is search("Permission denied")
    fail_msg: "{{ deleted_forbidden | string }}"

- name: state=deleted with an invalid token
  community.hashi_vault.vault_kv2:
    path: module_kv_v2/write1
    token: token
    state: deleted
  ignore_errors: true
  register: deleted_invalid_token

- assert:
    that:
      - deleted_invalid_token is failed
      - deleted_invalid_token is search("Invalid Vault Token")
    fail_msg: "{{ deleted_invalid_token | string }}"
